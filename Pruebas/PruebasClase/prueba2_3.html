<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba 2.3 - Calendario de Examenes</title>
    <link rel="stylesheet" href="../../styles.css">
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: url('../../Assets/PruebaCalendarioDeExamenes.jpg');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .game-container {
            max-width: 1000px;
            background: rgba(182, 182, 182, 0.6);
            max-height: fit-content;
            padding: 5px;
        }
        
        .content {
            margin: 0;
        }

        .header {
            text-align: center;
            padding: 0;
            flex-shrink: 0;
            margin-bottom: 0;
        }

        .header h1 {
            margin: 0;
            padding: 0;
            font-size: 1.4rem;
        }

        .instruction {
            background: rgba(255, 243, 205, 0.9);
            padding: 0.8rem;
            border-left: 4px solid #d4a017;
            color: #6a4f0f;
            font-size: 0.8rem;
            margin-top: 0.5rem
        }

        .boards-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 3rem;
            max-width: 900px;
            padding: 0 1rem;
        }

        .board-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .board-title {
            font-weight: bold;
            color: #322020;
            font-size: 1.1rem;
            text-transform: uppercase;
        }

        .pips-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            max-width: 400px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
        }

        .pip-cell {
            aspect-ratio: 1;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 2rem;
            position: relative;
        }

        .pip-cell:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .pip-cell.filled {
            background: #3f2929;
            border-color: #654949;
        }


        .pip-cell.filled::after {
            content: '●';
            color: white;
            font-size: 2.5rem;
        }


        .target-display {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            max-width: none;
            width: 100%;
        }


        .target-title {
            font-weight: bold;
            color: #322020;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }


        .target-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.3rem;
            max-width: 250px;
            margin: 0 auto;
        }


        .target-cell {
            aspect-ratio: 1;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
        }


        .target-cell.target-filled::after {
            content: '●';
            color: #591f1f;
            font-size: 1.2rem;
        }


        .game-info {
            text-align: center;
            font-size: 1.1rem;
            color: #2c3e50;
            margin-top: 10px;
        }


        .moves-counter {
            font-weight: bold;
            color: #7e170c;
        }


        .controls {
            display: flex;
            justify-content: center;
            margin: 0.5rem 0;
        }


        .reset-btn {
            padding: 0.8rem 1.5rem;
            background: #934036;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }


        .reset-btn:hover {
            background: #6a2e28;
        }

</style>
</head>
<body>
    <div class="game-wrapper">
        <button class="back-btn" onclick="goBack()">← Volver a Clase</button>

        <div class="overlay"></div>

        <div class="intro-overlay" id="introOverlay">
            <div class="intro-dialogue">
                <div class="intro-text">
                    Estás en clase, dejando a la gente trabajar cuando alguien te levanta la mano.<br> 
                    Los alumnos tienen demasiados trabajos y exámenes, necesitáis otra fecha para el examen porque se pisa con el trabajo k,<br>
                    el examen de xue hua piao piao y el evento de la Luna III Gordibolitas pam-pam. <br><br>
                    Cómo todos los demás profesores ya se saben los trucos, han pillado las fechas con margen, <br>
                    te toca a ti hacer los malabares para encajar cuando poner el examen. <br>

                </div>
                <button class="continue-btn" onclick="closeIntro()">Continuar</button>
            </div>
        </div>

        <div class="game-container">
            <div class="header">
                <h1>CALENDARIO DE EXÁMENES</h1>
            </div>

            <div class="content">
                <div class="instruction">
                    <strong>OBJETIVO:</strong> Replica el patrón objetivo. Cada clic cambia la casilla seleccionada y sus vecinas (arriba, abajo, izquierda, derecha).
                </div>

                <!-- TABLEROS LADO A LADO -->
                <div class="boards-container">
                    <!-- Tablero Objetivo (Izquierda) -->
                    <div class="board-section">
                        <div class="board-title">Patrón Objetivo</div>
                        <div class="target-display">
                            <div class="target-title">PATRÓN OBJETIVO:</div>
                            <div class="target-grid" id="targetGrid"></div>
                        </div>
                    </div>

                    <!-- Tablero de Juego (Derecha) -->
                    <div class="board-section">
                        <div class="board-title">Tablero de Juego</div>
                        <div class="target-display">
                            <div class="pips-board" id="pipsBoard"></div>
                        </div>
                    </div>
                </div>

                <div class="game-info">
                    Movimientos: <span class="moves-counter" id="movesCounter">0</span>
                </div>

                <div class="controls">
                    <button class="reset-btn" onclick="resetBoard()">Reiniciar</button>
                    <button class="reset-btn" style="background: #2b4759;" onclick="showSolution()">Ver Solución</button>
                </div>

                <div id="message" class="message hidden"></div>
            </div>

            <div class="content hidden" id="examIntro">
                <div class="exam-dialogue">
                    Perfecto, ahora que tienes la fecha seleccionada, deberías comprobar cómo de difícil es el examen que dejó el anterior profesor para asegurarte de que los alumnos lo pueden resolver...<br>¡Vamos allá, seguro que no es muy complicado!
                </div>
                <img src="../../Assets/Examen.jpg" alt="Examen imposible" class="exam-image">
                <input type="text" class="exam-input" id="q1" placeholder="Tu respuesta para la pregunta 1...">
                <button class="submit-btn" onclick="nextQuestion(2)">Responder Pregunta 1</button>
            </div>

            <div class="content hidden" id="exam2">
                <div class="exam-dialogue">
                    ¿Eh, cómo que ese no? Bueno, da igual, seguro que el segundo sí que es fácil.
                </div>
                <img src="../../Assets/Examen.jpg" alt="Examen imposible" class="exam-image">
                <input type="text" class="exam-input" id="q2" placeholder="Tu respuesta para la pregunta 2...">
                <button class="submit-btn" onclick="nextQuestion(3)">Responder Pregunta 2</button>
            </div>

            <div class="content hidden" id="exam3">
                <div class="exam-dialogue">
                    Pues parece que sí que les piden nivel en esta uni, madre...
                </div>
                <img src="../../Assets/Examen.jpg" alt="Examen imposible" class="exam-image">
                <input type="text" class="exam-input" id="q3" placeholder="Tu respuesta para la pregunta 3...">
                <button class="submit-btn" onclick="finishExam()">Responder Pregunta 3</button>
            </div>

            <div class="content hidden" id="finalContent">
                <div class="exam-dialogue">
                    Bah, da igual. Seguro que los chicos lo pueden resolver, que son muy listos.
                </div>
                <button class="complete-btn" onclick="completeAndGoBack()">Completado - Volver a Clase</button>
                <button class="complete-btn hidden" id="completeBtn" onclick="completeAndGoBack()">Completado - Volver a Clase</button>
            </div>
        </div>
    </div>

    <script>
        const GRID_SIZE = 5;
        let board = Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(false));
        let targetPattern = [
            [false, true, false, true, false],
            [true, false, true, false, true],
            [false, true, true, true, false],
            [true, false, true, false, true],
            [false, true, false, true, false]
        ];
        let moves = 0;
        
        // Solución verificada para este patrón
        const solution = [
            [0, 1], [0, 3],
            [1, 0], [1, 4],
            [2, 2],
            [3, 0], [3, 4],
            [4, 1], [4, 3]
        ];

        function initGame() {
            renderBoard();
            renderTarget();
        }

        function renderTarget() {
            const targetGrid = document.getElementById('targetGrid');
            targetGrid.innerHTML = '';

            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'target-cell';
                    if (targetPattern[i][j]) {
                        cell.classList.add('target-filled');
                    }
                    targetGrid.appendChild(cell);
                }
            }
        }

        function renderBoard() {
            const pipsBoard = document.getElementById('pipsBoard');
            pipsBoard.innerHTML = '';

            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'pip-cell';
                    if (board[i][j]) {
                        cell.classList.add('filled');
                    }
                    cell.onclick = () => handleClick(i, j);
                    pipsBoard.appendChild(cell);
                }
            }
        }

        function handleClick(row, col) {
            // Toggle la casilla clickeada
            board[row][col] = !board[row][col];

            // Toggle las casillas adyacentes
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]]; // arriba, abajo, izquierda, derecha

            for (const [dx, dy] of directions) {
                const newRow = row + dx;
                const newCol = col + dy;
                
                if (newRow >= 0 && newRow < GRID_SIZE && newCol >= 0 && newCol < GRID_SIZE) {
                    board[newRow][newCol] = !board[newRow][newCol];
                }
            }

            moves++;
            document.getElementById('movesCounter').textContent = moves;

            renderBoard();
            checkWin();
        }

        function checkWin() {
            const isMatch = board.every((row, i) => 
                row.every((cell, j) => cell === targetPattern[i][j])
            );

            if (isMatch) {
                showMessage(`¡Perfecto! Has encontrado la fecha ideal en ${moves} movimientos.`, 'success');
                document.getElementById('pipsBoard').style.pointerEvents = 'none';
                
                // Ocultar la sección del juego y mostrar el diálogo del examen
                setTimeout(() => {
                    document.querySelector('.content').classList.add('hidden');
                    document.getElementById('examIntro').classList.remove('hidden');
                }, 2000);
                
                localStorage.setItem('prueba2_3_completed', 'true');
            }
        }

        function nextQuestion(num) {
            if (num === 2) {
                document.getElementById('examIntro').classList.add('hidden');
                document.getElementById('exam2').classList.remove('hidden');
            } else if (num === 3) {
                document.getElementById('exam2').classList.add('hidden');
                document.getElementById('exam3').classList.remove('hidden');
            }
        }

        function finishExam() {
            document.getElementById('exam3').classList.add('hidden');
            document.getElementById('finalContent').classList.remove('hidden');
        }

        function resetBoard() {
            board = Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(false));
            moves = 0;
            document.getElementById('movesCounter').textContent = moves;
            document.getElementById('message').classList.add('hidden');
            renderBoard();
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type}`;
            msg.classList.remove('hidden');
            
            setTimeout(() => {
                if (type === 'error' || type === 'info') {
                    msg.classList.add('hidden');
                }
            }, 3000);
        }

        function showSolution() {
            if (confirm('¿Quieres que el juego se resuelva automáticamente?')) {
                resetBoard();
                
                let delay = 0;
                solution.forEach(([row, col], index) => {
                    setTimeout(() => {
                        handleClick(row, col);
                    }, delay);
                    delay += 400;
                });
            }
        }

        function closeIntro() {
            const overlay = document.getElementById('introOverlay');
            overlay.style.animation = 'fadeOut 0.5s';
            setTimeout(() => {
                overlay.classList.add('hidden');
            }, 500);
        }

        function goBack() {
            window.location.href = '../../Escenarios/clase.html';
        }

        function completeAndGoBack() {
            localStorage.setItem('prueba2_3_completed', 'true');
            window.location.href = '../../Escenarios/clase.html';
        }

        window.onload = function() {
            initGame();
        };
    </script>
</body>
</html>