<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba 2 - Portal del Curso</title>
    <link rel="stylesheet" href="../../styles.css">
    <style>
        body {
            background-image: url('../../Assets/PruebaAccederAlCurso.jpg');
            background-size: cover;
            background-position: center;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .overlay {
            background: rgba(0, 0, 0, 0.85);
        }

        .game-container {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 550px;
            max-height: 100vh;
            padding: 1rem;
        }

        .hint-section {
            background: rgba(176, 164, 127, 0.9);
            padding: 0.5rem;
            border-radius: 5px;
            text-align: center;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">← Volver al Despacho</button>
    
    <div class="overlay"></div>
    
    <div class="game-container">
        <h1>ACCESO AL PORTAL</h1>
        <p class="subtitle">Adivina la palabra clave de 5 letras</p>

        <div class="hint-section">
            <button class="hint-btn" id="hintBtn1" onclick="showHint(1)">Pista: Vocal</button>
            <button class="hint-btn" id="hintBtn2" onclick="showHint(2)">Pista: Consonante</button>
            <div class="hint-text" id="hintText"></div>
        </div>

        <div class="board" id="board"></div>

        <div class="keyboard">
            <div class="keyboard-row">
                <button class="key" onclick="pressKey('Q')">Q</button>
                <button class="key" onclick="pressKey('W')">W</button>
                <button class="key" onclick="pressKey('E')">E</button>
                <button class="key" onclick="pressKey('R')">R</button>
                <button class="key" onclick="pressKey('T')">T</button>
                <button class="key" onclick="pressKey('Y')">Y</button>
                <button class="key" onclick="pressKey('U')">U</button>
                <button class="key" onclick="pressKey('I')">I</button>
                <button class="key" onclick="pressKey('O')">O</button>
                <button class="key" onclick="pressKey('P')">P</button>
            </div>
            <div class="keyboard-row">
                <button class="key" onclick="pressKey('A')">A</button>
                <button class="key" onclick="pressKey('S')">S</button>
                <button class="key" onclick="pressKey('D')">D</button>
                <button class="key" onclick="pressKey('F')">F</button>
                <button class="key" onclick="pressKey('G')">G</button>
                <button class="key" onclick="pressKey('H')">H</button>
                <button class="key" onclick="pressKey('J')">J</button>
                <button class="key" onclick="pressKey('K')">K</button>
                <button class="key" onclick="pressKey('L')">L</button>
                <button class="key" onclick="pressKey('Ñ')">Ñ</button>
            </div>
            <div class="keyboard-row">
                <button class="key wide" onclick="submitWord()">ENTER</button>
                <button class="key" onclick="pressKey('Z')">Z</button>
                <button class="key" onclick="pressKey('X')">X</button>
                <button class="key" onclick="pressKey('C')">C</button>
                <button class="key" onclick="pressKey('V')">V</button>
                <button class="key" onclick="pressKey('B')">B</button>
                <button class="key" onclick="pressKey('N')">N</button>
                <button class="key" onclick="pressKey('M')">M</button>
                <button class="key wide" onclick="deleteLetter()">BORRAR</button>
            </div>
        </div>

        <div id="message" class="message hidden"></div>
        <button class="complete-btn hidden" id="completeBtn" onclick="completeAndGoBack()">Completado - Volver al Despacho</button>
    </div>

    <script>
        const WORD = "RITMO";
        const WORD_LENGTH = 5;
        const MAX_GUESSES = 6;

        const VALID_WORDS = [
            'ACORDE', 'AGUDO', 'ARCOS', 'BANDA', 'BLUES', 'BRAVO', 'CALMA', 
            'CANON', 'CANTO', 'CLAVE', 'CORAL', 'DANZA', 'DIESI', 'DRUMS',
            'ETUDE', 'FAGOT', 'FRASE', 'FUGAZ', 'GRAVE', 'GRITO', 'GRUPO',
            'LENTO', 'LOWER', 'MAYOR', 'MEDIO', 'MENOR', 'METAL', 'METRO',
            'MODAL', 'MODOS', 'MUDAR', 'NOTAS', 'OBOES', 'OPERA', 'PAUSA',
            'PEDAL', 'PIANO', 'PULSO', 'PUNTO', 'RITMO', 'RONDA', 'SALSA',
            'SALTO', 'SCALA', 'SERIE', 'SEXTA', 'SIGNS', 'SONES', 'SONGS',
            'SUAVE', 'TANGO', 'TEMPO', 'TENOR', 'TIPLE', 'TONAL', 'TONOS',
            'TRINO', 'TUBAR', 'TUPLA', 'ULTRA', 'UNION', 'VALSE', 'VALS',
            'VIHLA', 'VOCAL', 'VOCES'
        ];

        let currentGuess = "";
        let currentRow = 0;
        let gameOver = false;
        let hintsUsed = 0;

        function showHint(hintNum) {
            if (gameOver) return;
            
            const hintText = document.getElementById('hintText');
            
            if (hintNum === 1 && hintsUsed < 1) {
                const vowels = ['I', 'O'];
                const randomVowel = vowels[Math.floor(Math.random() * vowels.length)];
                hintText.textContent = `Pista: La palabra contiene la vocal: ${randomVowel}`;
                hintText.classList.add('visible');
                document.getElementById('hintBtn1').disabled = true;
                hintsUsed = 1;
            } else if (hintNum === 2 && hintsUsed < 2) {
                const consonants = ['R', 'T', 'M'];
                const randomConsonant = consonants[Math.floor(Math.random() * consonants.length)];
                hintText.textContent = `Pista: La palabra contiene la consonante: ${randomConsonant}`;
                hintText.classList.add('visible');
                document.getElementById('hintBtn2').disabled = true;
                hintsUsed = 2;
            }
        }

        function initBoard() {
            const board = document.getElementById('board');
            for (let i = 0; i < MAX_GUESSES; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                for (let j = 0; j < WORD_LENGTH; j++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.id = `tile-${i}-${j}`;
                    row.appendChild(tile);
                }
                board.appendChild(row);
            }
        }

        function pressKey(letter) {
            if (gameOver || currentGuess.length >= WORD_LENGTH) return;
            
            currentGuess += letter;
            updateBoard();
        }

        function deleteLetter() {
            if (gameOver || currentGuess.length === 0) return;
            
            currentGuess = currentGuess.slice(0, -1);
            updateBoard();
        }

        function updateBoard() {
            for (let i = 0; i < WORD_LENGTH; i++) {
                const tile = document.getElementById(`tile-${currentRow}-${i}`);
                if (i < currentGuess.length) {
                    tile.textContent = currentGuess[i];
                    tile.classList.add('filled');
                } else {
                    tile.textContent = '';
                    tile.classList.remove('filled');
                }
            }
        }

        function submitWord() {
            if (gameOver || currentGuess.length !== WORD_LENGTH) {
                showMessage('La palabra debe tener 5 letras', 'error');
                return;
            }

            if (!VALID_WORDS.includes(currentGuess.toUpperCase())) {
                showMessage('Palabra no valida', 'error');
                return;
            }

            checkGuess();
        }

        function checkGuess() {
            const guess = currentGuess.toUpperCase();
            const letterCount = {};
            
            for (let letter of WORD) {
                letterCount[letter] = (letterCount[letter] || 0) + 1;
            }

            for (let i = 0; i < WORD_LENGTH; i++) {
                const tile = document.getElementById(`tile-${currentRow}-${i}`);
                const letter = guess[i];
                
                if (letter === WORD[i]) {
                    tile.classList.add('correct');
                    updateKeyboard(letter, 'correct');
                    letterCount[letter]--;
                }
            }

            for (let i = 0; i < WORD_LENGTH; i++) {
                const tile = document.getElementById(`tile-${currentRow}-${i}`);
                const letter = guess[i];
                
                if (letter === WORD[i]) continue;
                
                if (WORD.includes(letter) && letterCount[letter] > 0) {
                    tile.classList.add('present');
                    updateKeyboard(letter, 'present');
                    letterCount[letter]--;
                } else {
                    tile.classList.add('absent');
                    updateKeyboard(letter, 'absent');
                }
            }

            if (guess === WORD) {
                gameOver = true;
                showMessage('Acceso concedido. Has desbloqueado el portal.', 'success');
                document.getElementById('completeBtn').classList.remove('hidden');
                document.querySelectorAll('.key').forEach(key => key.disabled = true);
            } else if (currentRow === MAX_GUESSES - 1) {
                gameOver = true;
                showMessage(`Acceso denegado. La palabra era: ${WORD}`, 'error');
                setTimeout(() => location.reload(), 3000);
            } else {
                currentRow++;
                currentGuess = "";
            }
        }

        function updateKeyboard(letter, state) {
            const keys = document.querySelectorAll('.key');
            keys.forEach(key => {
                if (key.textContent === letter) {
                    if (state === 'correct') {
                        key.className = 'key correct';
                    } else if (state === 'present' && !key.classList.contains('correct')) {
                        key.className = 'key present';
                    } else if (state === 'absent' && !key.classList.contains('correct') && !key.classList.contains('present')) {
                        key.className = 'key absent';
                    }
                }
            });
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type}`;
            msg.classList.remove('hidden');
        }

        document.addEventListener('keydown', (e) => {
            if (gameOver) return;
            
            const key = e.key.toUpperCase();
            if (/^[A-ZÑ]$/.test(key)) {
                pressKey(key);
            } else if (key === 'ENTER') {
                submitWord();
            } else if (key === 'BACKSPACE') {
                deleteLetter();
            }
        });

        function goBack() {
            window.location.href = '../../Escenarios/despacho.html';
        }

        function completeAndGoBack() {
            localStorage.setItem('prueba2_completed', 'true');
            window.location.href = '../../Escenarios/despacho.html';
        }

        initBoard();
    </script>
</body>
</html>